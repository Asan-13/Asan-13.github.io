# 修复方案

## 问题1：预览卡片重复栏信息无内容

### 原因
在`showPreviewCard`函数中，每月重复事件只显示日期，没有显示时间。

### 修复
在monthly case中添加默认时间显示：
```javascript
case "monthly":
    // ... 现有代码 ...
    // 默认显示每天开始时间
    else {
        recurrenceText += ` ${currentTask.startTime || "00:00"}`;
    }
    break;
```

## 问题2：日期无效

### 原因
在admin.html中，添加新任务时，每月和每周重复事件的startTime被硬编码为'00:00'。

### 修复
从表单中获取startTime，而不是硬编码：
```javascript
case 'weekly':
    startDate = document.getElementById('weekly-start-date').value;
    startTime = document.getElementById('weekly-start-time').value;
    break;
case 'monthly':
    startDate = document.getElementById('monthly-start-date').value;
    startTime = document.getElementById('monthly-start-time').value;
    break;
```

## 问题3：monthdays字段兼容性问题

### 原因
在admin.html中，处理月度重复日期选择时，兼容了旧的monthdays和新的days属性，但在保存任务时，只使用了monthdays。

### 修复
确保保存时使用统一的days属性，并转换为数字类型：
```javascript
const monthdays = Array.from(document.querySelectorAll('input[name="monthday"]:checked')).map(checkbox => Number(checkbox.value));
newTask.recurrence.days = monthdays; // 统一属性名为days
```

## 问题4：预览卡片中日期显示错误

### 原因
在`showPreviewCard`函数中，当initialStart是无效的Date对象时，会导致日期显示错误。

### 修复
加强日期对象验证：
```javascript
// 确保initialStart是有效的Date对象
if (!initialStart || isNaN(initialStart.getTime())) {
    // 完整的日期修复逻辑
    // ...
}
```

## 问题5：每月重复事件的startTime处理不一致

### 原因
在不同的case中，startTime的处理方式不一致，有的使用currentTask.startTime，有的使用currentTask.recurrence.startTime。

### 修复
统一使用currentTask.startTime，并确保其在所有情况下都被正确设置。

## 修复优先级

1. ✅ 预览卡片重复栏信息无内容 - 影响用户体验
2. ✅ 日期无效 - 影响数据准确性
3. ✅ monthdays字段兼容性问题 - 影响数据一致性
4. ✅ 预览卡片中日期显示错误 - 影响用户体验
5. ✅ 每月重复事件的startTime处理不一致 - 影响代码可维护性