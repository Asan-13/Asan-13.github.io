<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>163目录修复测试</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-case { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .pass { color: green; }
        .fail { color: red; }
    </style>
</head>
<body>
    <h1>163目录修复测试</h1>
    <div id="results"></div>

    <script>
        // 模拟测试数据
        const testCases = [
            {
                name: "每天时间段间隔事件",
                task: {
                    recurrence: {
                        type: "daily",
                        intervalCount: 2,
                        intervalUnit: "hour",
                        customTimes: ["00:00"]
                    }
                },
                expected: "每天 每2小时"
            },
            {
                name: "每周时间段间隔事件",
                task: {
                    recurrence: {
                        type: "weekly",
                        weekdays: [1, 3, 5],
                        intervalCount: 1,
                        intervalUnit: "week",
                        customTimes: ["00:00"]
                    }
                },
                expected: "每周周一,周三,周五 每1周"
            },
            {
                name: "无间隔的每天事件",
                task: {
                    recurrence: {
                        type: "daily",
                        customTimes: ["08:00"]
                    }
                },
                expected: "每天"
            },
            {
                name: "无间隔的每周事件",
                task: {
                    recurrence: {
                        type: "weekly",
                        weekdays: [0, 6],
                        customTimes: ["10:00"]
                    }
                },
                expected: "每周周日,周六"
            }
        ];

        // 测试事件列表部分的重复信息生成
        function testRecurrenceText(task) {
            let recurrenceText = "";
            const unitNames = {
                "minute": "分钟",
                "hour": "小时",
                "day": "天",
                "week": "周",
                "month": "月"
            };

            switch(task.recurrence.type) {
                case "none":
                    recurrenceText = "不重复";
                    break;
                case "daily":
                    recurrenceText = "每天";
                    // 如果是时间段间隔事件，添加间隔信息
                    if (task.recurrence.intervalCount && task.recurrence.intervalUnit) {
                        recurrenceText += ` 每${task.recurrence.intervalCount}${unitNames[task.recurrence.intervalUnit]}`;
                    }
                    break;
                case "daily_times":
                    // 简化时间显示：将"08:00"格式转换为"8点"
                    let simplifiedTimes = task.recurrence.customTimes.map(time => {
                        const hour = parseInt(time.split(':')[0]);
                        return `${hour}点`;
                    });
                    recurrenceText = `每天 ${simplifiedTimes.join(', ')}`;
                    break;
                case "weekly":
                    const dayNames = ["周日", "周一", "周二", "周三", "周四", "周五", "周六"];
                    const selectedDays = task.recurrence.weekdays?.map(day => dayNames[day]).join(', ') || "";
                    recurrenceText = `每周${selectedDays}`;
                    // 如果是时间段间隔事件，添加间隔信息
                    if (task.recurrence.intervalCount && task.recurrence.intervalUnit) {
                        recurrenceText += ` 每${task.recurrence.intervalCount}${unitNames[task.recurrence.intervalUnit]}`;
                    }
                    break;
                default:
                    recurrenceText = "未知重复方式";
            }

            return recurrenceText;
        }

        // 运行测试
        const resultsDiv = document.getElementById('results');
        let allPassed = true;

        testCases.forEach((testCase, index) => {
            const result = testRecurrenceText(testCase.task);
            const passed = result === testCase.expected;
            allPassed = allPassed && passed;

            const testDiv = document.createElement('div');
            testDiv.className = 'test-case';
            testDiv.innerHTML = `
                <h3>测试 ${index + 1}: ${testCase.name}</h3>
                <p>预期: ${testCase.expected}</p>
                <p>实际: ${result}</p>
                <p class="${passed ? 'pass' : 'fail'}">结果: ${passed ? '通过' : '失败'}</p>
            `;
            resultsDiv.appendChild(testDiv);
        });

        const summaryDiv = document.createElement('div');
        summaryDiv.innerHTML = `<h2>总体结果: ${allPassed ? '<span class="pass">全部通过</span>' : '<span class="fail">部分失败</span>'}</h2>`;
        resultsDiv.insertBefore(summaryDiv, resultsDiv.firstChild);
    </script>
</body>
</html>