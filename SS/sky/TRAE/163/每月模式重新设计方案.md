# 每月模式重新设计方案

## 1. 问题分析

当前每月模式实现存在以下问题：

- 功能混乱，代码结构不清晰
- 子模式处理逻辑复杂
- admin文件与index文件的模式定义不一致
- 缺乏清晰的子模式划分

## 2. 重新设计的子模式

重新设计后的每月模式将包含以下子模式：

### 2.1 每月特定日期
- **描述**：在每月的特定日期重复（如每月1日、15日）
- **支持**：单日期或多日期
- **时间**：使用任务的startTime

### 2.2 每月特定时间点
- **描述**：在每月的特定日期的特定时间点重复（如每月1日 10:00、14:00）
- **支持**：单日期或多日期，每个日期可设置多个时间点
- **时间**：使用customTimes数组

### 2.3 每月时间段间隔
- **描述**：在每月的特定日期的特定时间段内按间隔重复（如每月1日 09:00-18:00 每2小时）
- **支持**：单日期或多日期，每个日期使用相同的时间段和间隔
- **时间**：使用rangeStart、rangeEnd、intervalCount、intervalUnit

## 3. 数据结构设计

### 3.1 每月特定日期
```json
{
  "recurrence": {
    "type": "monthly",
    "subType": "date",
    "days": [1, 15],
    "duration": 1,
    "durationUnit": "hour"
  }
}
```

### 3.2 每月特定时间点
```json
{
  "recurrence": {
    "type": "monthly",
    "subType": "time-points",
    "days": [1, 15],
    "customTimes": ["10:00", "14:00"],
    "duration": 1,
    "durationUnit": "hour"
  }
}
```

### 3.3 每月时间段间隔
```json
{
  "recurrence": {
    "type": "monthly",
    "subType": "time-range",
    "days": [1, 15],
    "rangeStart": "09:00",
    "rangeEnd": "18:00",
    "intervalCount": 2,
    "intervalUnit": "hour",
    "duration": 1,
    "durationUnit": "hour"
  }
}
```

## 4. 实现步骤

### 4.1 index.html 实现
1. 重新组织getNextOccurrence函数的monthly case
2. 按子模式分别处理不同的逻辑
3. 确保代码结构清晰，易于维护

### 4.2 admin.html 实现
1. 同步更新monthly模式的表单
2. 按子模式提供不同的设置选项
3. 确保数据结构与index.html一致

## 5. 测试计划

1. 测试每月特定日期模式
2. 测试每月特定时间点模式
3. 测试每月时间段间隔模式
4. 测试多日期场景
5. 测试跨月场景
6. 测试事件当日场景
7. 测试预览卡片显示

## 6. 修复进度

- [x] 分析问题
- [x] 设计子模式
- [x] 设计数据结构
- [ ] 实现index.html
- [ ] 实现admin.html
- [ ] 测试验证

## 7. 预期效果

- 清晰的子模式划分
- 易于使用的admin界面
- 准确的事件计算和显示
- 良好的代码结构和可维护性
