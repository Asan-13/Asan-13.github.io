<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>测试每月间隔事件编辑功能</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border: 1px solid #ddd; }
        .pass { background-color: #d4edda; color: #155724; }
        .fail { background-color: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>测试每月间隔事件编辑功能</h1>
    <div id="test-results"></div>

    <script>
        // 测试数据：每月间隔事件
        const monthlyIntervalTask = {
            id: "test-123",
            name: "测试每月间隔事件",
            priority: "medium",
            startTime: "11:00",
            recurrence: {
                type: "monthly_interval",
                duration: 10,
                durationUnit: "minute",
                days: [1, 15],
                interval: 4,  // 使用interval而不是count
                intervalUnit: "hour"  // 使用intervalUnit而不是unit
            },
            displayThreshold: 30,
            displayThresholdUnit: "minute"
        };

        // 测试数据：普通间隔事件（使用count和unit）
        const normalIntervalTask = {
            id: "test-456",
            name: "测试普通间隔事件",
            priority: "low",
            startTime: "09:00",
            recurrence: {
                type: "daily",
                duration: 30,
                durationUnit: "minute",
                count: 2,  // 使用count
                unit: "day"  // 使用unit
            },
            displayThreshold: 15,
            displayThresholdUnit: "minute"
        };

        /**
         * 测试修复后的间隔值获取逻辑
         * 这是从showEditTaskModal函数中提取的核心逻辑
         */
        function getIntervalValues(task) {
            // monthly_interval类型使用interval而不是count
            const intervalCount = task.recurrence.type === "monthly_interval" ? task.recurrence.interval : task.recurrence.count;
            const intervalUnit = task.recurrence.type === "monthly_interval" ? task.recurrence.intervalUnit : task.recurrence.unit;
            return { intervalCount, intervalUnit };
        }

        /**
         * 测试函数
         */
        function runTests() {
            const results = [];
            const testResultsDiv = document.getElementById('test-results');
            testResultsDiv.innerHTML = '';

            // 测试1：monthly_interval类型事件
            try {
                const values = getIntervalValues(monthlyIntervalTask);
                const expectedCount = 4;
                const expectedUnit = "hour";
                
                if (values.intervalCount === expectedCount && values.intervalUnit === expectedUnit) {
                    results.push({ name: "测试每月间隔事件", status: "pass", message: `成功获取间隔值: ${values.intervalCount} ${values.intervalUnit}` });
                } else {
                    results.push({ name: "测试每月间隔事件", status: "fail", message: `获取的间隔值不正确: ${values.intervalCount} ${values.intervalUnit}，期望: ${expectedCount} ${expectedUnit}` });
                }
            } catch (error) {
                results.push({ name: "测试每月间隔事件", status: "fail", message: `出现错误: ${error.message}` });
            }

            // 测试2：普通间隔事件
            try {
                const values = getIntervalValues(normalIntervalTask);
                const expectedCount = 2;
                const expectedUnit = "day";
                
                if (values.intervalCount === expectedCount && values.intervalUnit === expectedUnit) {
                    results.push({ name: "测试普通间隔事件", status: "pass", message: `成功获取间隔值: ${values.intervalCount} ${values.intervalUnit}` });
                } else {
                    results.push({ name: "测试普通间隔事件", status: "fail", message: `获取的间隔值不正确: ${values.intervalCount} ${values.intervalUnit}，期望: ${expectedCount} ${expectedUnit}` });
                }
            } catch (error) {
                results.push({ name: "测试普通间隔事件", status: "fail", message: `出现错误: ${error.message}` });
            }

            // 测试3：测试空的间隔值
            try {
                const taskWithEmptyValues = {
                    recurrence: {
                        type: "monthly_interval",
                        // 没有interval和intervalUnit
                    }
                };
                const values = getIntervalValues(taskWithEmptyValues);
                
                // 应该返回默认值
                if (values.intervalCount === undefined && values.intervalUnit === undefined) {
                    results.push({ name: "测试空间隔值", status: "pass", message: "正确处理了空的间隔值" });
                } else {
                    results.push({ name: "测试空间隔值", status: "fail", message: `处理空间隔值的结果不正确: ${values.intervalCount} ${values.intervalUnit}` });
                }
            } catch (error) {
                results.push({ name: "测试空间隔值", status: "fail", message: `出现错误: ${error.message}` });
            }

            // 显示测试结果
            results.forEach(result => {
                const resultDiv = document.createElement('div');
                resultDiv.className = `test-result ${result.status}`;
                resultDiv.textContent = `${result.name}: ${result.message}`;
                testResultsDiv.appendChild(resultDiv);
            });

            // 检查是否所有测试都通过
            const allPassed = results.every(result => result.status === "pass");
            const summaryDiv = document.createElement('div');
            summaryDiv.className = `test-result ${allPassed ? 'pass' : 'fail'}`;
            summaryDiv.innerHTML = `<strong>测试总结: ${allPassed ? '所有测试通过！修复有效。' : '有测试失败，需要进一步检查。'}</strong>`;
            testResultsDiv.appendChild(summaryDiv);
        }

        // 页面加载时运行测试
        window.onload = runTests;
    </script>
</body>
</html>