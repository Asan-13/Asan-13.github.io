<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>测试每天时间段间隔事件重复信息显示修复</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        .event-card {
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            background-color: #f9f9f9;
        }
        .event-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .event-recurrence {
            color: #666;
            margin-bottom: 5px;
        }
        .event-status {
            color: #007bff;
        }
        .success {
            color: green;
        }
        .error {
            color: red;
        }
    </style>
</head>
<body>
    <h1>测试每天时间段间隔事件重复信息显示修复</h1>
    
    <div class="event-card">
        <div class="event-title">测试事件 - 每天时间段间隔</div>
        <div class="event-recurrence">重复信息应该显示：每天 00:00 每2小时（示例）</div>
        <div class="event-status">修复前：每天 00:00（缺少间隔信息）</div>
        <div class="event-status">修复后：每天 00:00 每2小时（包含间隔信息）</div>
    </div>
    
    <button onclick="testDailyIntervalDisplay()">运行测试</button>
    <div id="test-result"></div>
    
    <script>
        // 模拟TimeZoneUtils类
        const TimeZoneUtils = {
            PDTtoCST: function(pdtDate) {
                // 简单模拟PDT到CST的转换（+15小时）
                const cstDate = new Date(pdtDate.getTime());
                cstDate.setHours(cstDate.getHours() + 15);
                return cstDate;
            },
            formatCSTDate: function(date) {
                return date.toLocaleDateString('zh-CN');
            },
            formatCSTTime: function(date) {
                return date.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
            }
        };
        
        // 模拟unitNames对象
        const unitNames = {
            'hour': '小时',
            'minute': '分钟',
            'day': '天'
        };
        
        // 测试函数：模拟修复后的重复信息显示逻辑
        function getRecurrenceText(task) {
            let recurrenceText = "";
            
            switch (task.recurrence.type) {
                case "daily":
                    // 显示每天的所有时间点（将太平洋时间转换为北京时间后显示）
                    if (task.recurrence.dailyRepeatType === "time-range" && task.recurrence.rangeStart) {
                        // 时间段模式：显示rangeStart作为开始时间
                        const [startHour, startMinute] = task.recurrence.rangeStart.split(':').map(Number);
                        const pdtDate = new Date();
                        pdtDate.setHours(startHour, startMinute, 0, 0);
                        const cstTime = TimeZoneUtils.formatCSTTime(TimeZoneUtils.PDTtoCST(pdtDate));
                        recurrenceText = `每天 ${cstTime}`;
                        
                        // 如果是时间段重复模式且有间隔信息，添加间隔显示
                        if (task.recurrence.intervalCount && task.recurrence.intervalUnit) {
                            const intervalCount = task.recurrence.intervalCount;
                            const intervalUnit = unitNames[task.recurrence.intervalUnit] || "小时";
                            recurrenceText += ` 每${intervalCount}${intervalUnit}`;
                        }
                    } else if (task.recurrence.startTimes && task.recurrence.startTimes.length > 0) {
                        // 时间点模式：显示所有时间点
                        const cstTimes = task.recurrence.startTimes.map(timeStr => {
                            const [startHour, startMinute] = timeStr.split(':').map(Number);
                            const pdtDate = new Date();
                            pdtDate.setHours(startHour, startMinute, 0, 0);
                            return TimeZoneUtils.formatCSTTime(TimeZoneUtils.PDTtoCST(pdtDate));
                        });
                        recurrenceText = `每天 ${cstTimes.join(', ')}`;
                    } else {
                        recurrenceText = "每天";
                    }
                    break;
                
                case "weekly":
                    // 这里可以添加每周事件的处理逻辑（如果需要）
                    break;
                
                default:
                    recurrenceText = "未知重复类型";
            }
            
            return recurrenceText;
        }
        
        // 测试场景
        function testDailyIntervalDisplay() {
            // 测试数据1：每天时间段间隔事件（有间隔信息）
            const testTask1 = {
                recurrence: {
                    type: "daily",
                    dailyRepeatType: "time-range",
                    rangeStart: "00:00",
                    intervalCount: 2,
                    intervalUnit: "hour"
                }
            };
            
            // 测试数据2：每天时间段间隔事件（无间隔信息）
            const testTask2 = {
                recurrence: {
                    type: "daily",
                    dailyRepeatType: "time-range",
                    rangeStart: "00:00"
                    // 没有intervalCount和intervalUnit
                }
            };
            
            // 测试数据3：每天时间点事件
            const testTask3 = {
                recurrence: {
                    type: "daily",
                    dailyRepeatType: "time-points",
                    startTimes: ["00:00", "12:00"]
                }
            };
            
            // 运行测试
            const result1 = getRecurrenceText(testTask1);
            const result2 = getRecurrenceText(testTask2);
            const result3 = getRecurrenceText(testTask3);
            
            // 显示测试结果
            const testResult = document.getElementById('test-result');
            testResult.innerHTML = `
                <div class="event-card">
                    <div class="event-title">测试结果：</div>
                    <div class="event-recurrence">1. 每天时间段间隔事件（有间隔）: ${result1}</div>
                    <div class="event-status ${result1.includes('每2小时') ? 'success' : 'error'}">
                        ${result1.includes('每2小时') ? '✅ 正确：包含间隔信息' : '❌ 错误：缺少间隔信息'}
                    </div>
                    <div class="event-recurrence">2. 每天时间段间隔事件（无间隔）: ${result2}</div>
                    <div class="event-status ${result2 === '每天 15:00' ? 'success' : 'error'}">
                        ${result2 === '每天 15:00' ? '✅ 正确：无间隔信息时不显示' : '❌ 错误：显示不正确'}
                    </div>
                    <div class="event-recurrence">3. 每天时间点事件: ${result3}</div>
                    <div class="event-status ${result3 === '每天 15:00, 03:00' ? 'success' : 'error'}">
                        ${result3 === '每天 15:00, 03:00' ? '✅ 正确：时间点模式正常' : '❌ 错误：时间点模式显示不正确'}
                    </div>
                </div>
            `;
        }
    </script>
</body>
</html>