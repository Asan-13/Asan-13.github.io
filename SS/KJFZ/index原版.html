<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÂçÅ‰∏â | Âø´Êç∑Â§çÂà∂</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Arial', sans-serif; }
        body { background-color: #121212; color: #e0e0e0; padding: 20px; min-height: 100vh; position: relative; }
        .title { text-align: center; margin-bottom: 15px; font-size: 24px; color: #fff; }
        
        .category-bar { max-width: 1200px; margin: 0 auto 20px; display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
        .category-btn { padding: 6px 14px; background-color: #1e1e1e; border: 1px solid #333; border-radius: 4px; cursor: pointer; transition: all 0.2s; position: relative; user-select: none; }
        .category-btn.active { background-color: #2196F3; color: #fff; border-color: #2196F3; }
        .category-btn.editing { background-color: #ff9800; border-color: #ff9800; }
        .category-btn.dragging { opacity: 0.5; background-color: #ff9800; transform: scale(1.05); z-index: 10; }
        .category-btn.drag-over { border: 2px dashed #2196F3; background-color: #2a2a2a; }
        .add-category-btn { padding: 6px 14px; background-color: #333; border: 1px solid #444; border-radius: 4px; cursor: pointer; transition: background 0.2s; }
        .add-category-btn:hover { background-color: #444; }
        
        .grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; max-width: 1200px; margin: 0 auto; padding-bottom: 80px; }
        .grid-item { background-color: #1e1e1e; border: 1px solid #333; border-radius: 4px; padding: 15px 10px; text-align: center; cursor: pointer; transition: all 0.2s; min-height: 60px; display: flex; align-items: center; justify-content: center; word-break: break-all; user-select: none; }
        .grid-item:hover { background-color: #2d2d2d; border-color: #555; }
        .grid-item.dragging { opacity: 0.5; background-color: #ff9800; transform: scale(1.05); z-index: 10; }
        .grid-item.drag-over { border: 2px dashed #2196F3; background-color: #2a2a2a; }
        
        .btn-group { position: fixed; bottom: 30px; right: 30px; display: flex; gap: 12px; }
        .func-btn { width: 50px; height: 50px; border-radius: 50%; border: none; color: #fff; font-size: 18px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: background 0.2s; box-shadow: 0 2px 8px rgba(0,0,0,0.3); }
        .add-grid-btn { background-color: #2196F3; }
        .add-grid-btn:hover { background-color: #1976D2; }
        .save-file-btn { background-color: #4CAF50; }
        .save-file-btn:hover { background-color: #388E3C; }
        
        .toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); padding: 8px 16px; border-radius: 4px; font-size: 14px; opacity: 0; transition: opacity 0.3s; pointer-events: none; }
        .copy-toast { background-color: #32cd32; color: #fff; }
        .save-toast { background-color: #ff9800; color: #fff; }
        .toast.show { opacity: 1; }
        
        .grid-item::-webkit-context-menu { display: none; }
        
        /* ÂàÜÁ±ªÁºñËæëËæìÂÖ•Ê°ÜÊ†∑Âºè */
        .category-input { 
            background: transparent; 
            border: none; 
            color: inherit; 
            font-size: inherit; 
            text-align: center; 
            outline: none; 
            width: 100%; 
            padding: 0;
        }
        
        /* Âè≥ÈîÆËèúÂçïÊ†∑Âºè */
        .context-menu {
            position: fixed;
            background: #2d2d2d;
            border: 1px solid #555;
            border-radius: 4px;
            padding: 8px 0;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            min-width: 120px;
        }
        
        .context-menu-item {
            padding: 8px 16px;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .context-menu-item:hover {
            background: #2196F3;
        }
        
        .context-menu-item.delete {
            color: #ff6b6b;
        }
        
        .context-menu-item.delete:hover {
            background: #ff6b6b;
            color: white;
        }
    </style>
</head>
<body>
    <h1 class="title">Âø´Êç∑Â§çÂà∂</h1>
    
    <div class="category-bar" id="categoryBar">
        <div class="category-btn active" data-category="all">ÂÖ®ÈÉ®</div>
        <!-- ÂàÜÁ±ªÊåâÈíÆÂ∞ÜÈÄöËøáJavaScriptÂä®ÊÄÅÁîüÊàê -->
        <button class="add-category-btn" id="addCategoryBtn">+</button>
    </div>
    
    <div class="grid-container" id="gridContainer">
        <!-- Ê†ºÂ≠êÂÜÖÂÆπÂ∞ÜÈÄöËøáJavaScriptÂä®ÊÄÅÁîüÊàê -->
    </div>
    
    <div class="btn-group">
        <button class="func-btn add-grid-btn" id="addGridBtn">+</button>
        <button class="func-btn save-file-btn" id="saveFileBtn">üíæ</button>
    </div>
    
    <div class="toast copy-toast" id="copyToast">Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø</div>
    <div class="toast save-toast" id="saveToast">Êñá‰ª∂Â∑≤ÂºÄÂßã‰∏ãËΩΩ</div>

    <script>
        // DOMÂÖÉÁ¥†
        const categoryBar = document.getElementById('categoryBar');
        const gridContainer = document.getElementById('gridContainer');
        const addCategoryBtn = document.getElementById('addCategoryBtn');
        const addGridBtn = document.getElementById('addGridBtn');
        const saveFileBtn = document.getElementById('saveFileBtn');
        const copyToast = document.getElementById('copyToast');
        const saveToast = document.getElementById('saveToast');

        // Ê†∏ÂøÉÊï∞ÊçÆ - ÂàùÂßãÊï∞ÊçÆ
        let appData = {
            grids: [
                { id: "grid_1", content: "Á§∫‰æãÊñáÊú¨1", category: "ÈªòËÆ§" },
                { id: "grid_2", content: "Á§∫‰æãÊñáÊú¨2", category: "ÈªòËÆ§" }
            ],
            categories: ["ÈªòËÆ§"]
        };

        let activeCategory = 'all';
        let dragSource = null; // ÂΩìÂâçÊãñÂä®ÁöÑÂÖÉÁ¥†

        // ÁîüÊàêÂîØ‰∏ÄID
        function generateUuid() {
            return 'grid_' + Date.now() + '_' + Math.floor(Math.random() * 1000);
        }

        // ÂàùÂßãÂåñÔºöÂÆåÂÖ®ÈÄöËøáJavaScriptÊ∏≤Êüì
        function init() {
            renderCategories();
            renderGridsByCategory();
            bindAllEvents();
        }

        // Ê∏≤ÊüìÂàÜÁ±ªÊ†è
        function renderCategories() {
            // ‰øùÂ≠òÂΩìÂâçÊøÄÊ¥ªÁöÑÂàÜÁ±ª
            const currentActiveCategory = activeCategory;
            
            // ÁßªÈô§ÊâÄÊúâËá™ÂÆö‰πâÂàÜÁ±ªÊåâÈíÆÔºà‰øùÁïô"ÂÖ®ÈÉ®"Âíå"Ê∑ªÂä†ÊåâÈíÆ"Ôºâ
            const customCategoryBtns = categoryBar.querySelectorAll('.category-btn:not([data-category="all"])');
            customCategoryBtns.forEach(btn => btn.remove());
            
            // ÈáçÊñ∞Ê∑ªÂä†ÊâÄÊúâÂàÜÁ±ª
            appData.categories.forEach(category => {
                const categoryBtn = document.createElement('div');
                categoryBtn.className = 'category-btn';
                categoryBtn.dataset.category = category;
                categoryBtn.textContent = category;
                categoryBtn.draggable = true; // ÂêØÁî®ÊãñÂä®
                
                // ÊÅ¢Â§çÊøÄÊ¥ªÁä∂ÊÄÅ
                if (category === currentActiveCategory) {
                    categoryBtn.classList.add('active');
                }
                
                categoryBar.insertBefore(categoryBtn, addCategoryBtn);
            });
            
            // Á°Æ‰øùËá≥Â∞ëÊúâ‰∏Ä‰∏™ÊøÄÊ¥ªÁä∂ÊÄÅ
            const activeBtn = categoryBar.querySelector('.category-btn.active');
            if (!activeBtn) {
                categoryBar.querySelector('.category-btn[data-category="all"]').classList.add('active');
                activeCategory = 'all';
            }
        }

        // ÊåâÂàÜÁ±ªÊ∏≤ÊüìÊ†ºÂ≠ê
        function renderGridsByCategory() {
            gridContainer.innerHTML = '';
            const filteredGrids = activeCategory === 'all' 
                ? appData.grids 
                : appData.grids.filter(grid => grid.category === activeCategory);

            filteredGrids.forEach(grid => {
                const gridElem = document.createElement('div');
                gridElem.className = 'grid-item';
                gridElem.contentEditable = 'false';
                gridElem.textContent = grid.content;
                gridElem.dataset.gridId = grid.id;
                gridElem.dataset.gridCategory = grid.category;
                gridElem.draggable = true; // ÂêØÁî®ÊãñÂä®
                gridContainer.appendChild(gridElem);
            });
        }

        // ÁªëÂÆöÊâÄÊúâ‰∫ã‰ª∂
        function bindAllEvents() {
            bindCategoryEvents();
            bindGridClickCopy();
            bindGridRightClickEdit();
            bindGridEditEnd();
            bindAddGrid();
            bindSaveFile();
            bindDragEvents(); // ÁªëÂÆöÊãñÂä®‰∫ã‰ª∂
        }

        // ÁªëÂÆöÊãñÂä®‰∫ã‰ª∂
        function bindDragEvents() {
            // ÂàÜÁ±ªÊãñÂä®‰∫ã‰ª∂
            bindCategoryDragEvents();
            // Ê†ºÂ≠êÊãñÂä®‰∫ã‰ª∂
            bindGridDragEvents();
        }

        // ÂàÜÁ±ªÊãñÂä®‰∫ã‰ª∂
        function bindCategoryDragEvents() {
            // ÊãñÂä®ÂºÄÂßã
            categoryBar.addEventListener('dragstart', (e) => {
                const categoryBtn = e.target.closest('.category-btn');
                if (!categoryBtn || categoryBtn.dataset.category === 'all') {
                    e.preventDefault();
                    return;
                }
                
                dragSource = categoryBtn;
                categoryBtn.classList.add('dragging');
                e.dataTransfer.effectAllowed = 'move';
                e.dataTransfer.setData('text/plain', categoryBtn.dataset.category);
            });

            // ÊãñÂä®ÁªèËøá
            categoryBar.addEventListener('dragover', (e) => {
                e.preventDefault();
                const categoryBtn = e.target.closest('.category-btn');
                if (!categoryBtn || categoryBtn === dragSource || categoryBtn.dataset.category === 'all') {
                    return;
                }
                
                categoryBtn.classList.add('drag-over');
                e.dataTransfer.dropEffect = 'move';
            });

            // ÊãñÂä®Á¶ªÂºÄ
            categoryBar.addEventListener('dragleave', (e) => {
                const categoryBtn = e.target.closest('.category-btn');
                if (categoryBtn) {
                    categoryBtn.classList.remove('drag-over');
                }
            });

            // ÊîæÁΩÆ
            categoryBar.addEventListener('drop', (e) => {
                e.preventDefault();
                const categoryBtn = e.target.closest('.category-btn');
                if (!categoryBtn || !dragSource || categoryBtn === dragSource || categoryBtn.dataset.category === 'all') {
                    return;
                }
                
                // ÁßªÈô§ÊãñÂä®Ê†∑Âºè
                document.querySelectorAll('.category-btn').forEach(btn => {
                    btn.classList.remove('drag-over');
                });
                
                // ‰∫§Êç¢ÂàÜÁ±ªÈ°∫Â∫è
                swapCategories(dragSource.dataset.category, categoryBtn.dataset.category);
                
                // ÈáçÊñ∞Ê∏≤ÊüìÂàÜÁ±ª
                renderCategories();
            });

            // ÊãñÂä®ÁªìÊùü
            categoryBar.addEventListener('dragend', (e) => {
                document.querySelectorAll('.category-btn').forEach(btn => {
                    btn.classList.remove('dragging', 'drag-over');
                });
                dragSource = null;
            });
        }

        // Ê†ºÂ≠êÊãñÂä®‰∫ã‰ª∂
        function bindGridDragEvents() {
            // ÊãñÂä®ÂºÄÂßã
            gridContainer.addEventListener('dragstart', (e) => {
                const gridItem = e.target.closest('.grid-item');
                if (!gridItem) {
                    e.preventDefault();
                    return;
                }
                
                dragSource = gridItem;
                gridItem.classList.add('dragging');
                e.dataTransfer.effectAllowed = 'move';
                e.dataTransfer.setData('text/plain', gridItem.dataset.gridId);
            });

            // ÊãñÂä®ÁªèËøá
            gridContainer.addEventListener('dragover', (e) => {
                e.preventDefault();
                const gridItem = e.target.closest('.grid-item');
                if (!gridItem || gridItem === dragSource) {
                    return;
                }
                
                gridItem.classList.add('drag-over');
                e.dataTransfer.dropEffect = 'move';
            });

            // ÊãñÂä®Á¶ªÂºÄ
            gridContainer.addEventListener('dragleave', (e) => {
                const gridItem = e.target.closest('.grid-item');
                if (gridItem) {
                    gridItem.classList.remove('drag-over');
                }
            });

            // ÊîæÁΩÆ
            gridContainer.addEventListener('drop', (e) => {
                e.preventDefault();
                const gridItem = e.target.closest('.grid-item');
                if (!gridItem || !dragSource || gridItem === dragSource) {
                    return;
                }
                
                // ÁßªÈô§ÊãñÂä®Ê†∑Âºè
                document.querySelectorAll('.grid-item').forEach(item => {
                    item.classList.remove('drag-over');
                });
                
                // ‰∫§Êç¢Ê†ºÂ≠êÈ°∫Â∫è
                swapGrids(dragSource.dataset.gridId, gridItem.dataset.gridId);
                
                // ÈáçÊñ∞Ê∏≤ÊüìÊ†ºÂ≠ê
                renderGridsByCategory();
            });

            // ÊãñÂä®ÁªìÊùü
            gridContainer.addEventListener('dragend', (e) => {
                document.querySelectorAll('.grid-item').forEach(item => {
                    item.classList.remove('dragging', 'drag-over');
                });
                dragSource = null;
            });
        }

        // ‰∫§Êç¢ÂàÜÁ±ªÈ°∫Â∫è
        function swapCategories(category1, category2) {
            const index1 = appData.categories.indexOf(category1);
            const index2 = appData.categories.indexOf(category2);
            
            if (index1 !== -1 && index2 !== -1) {
                // ‰∫§Êç¢Êï∞ÁªÑ‰∏≠ÁöÑ‰ΩçÁΩÆ
                [appData.categories[index1], appData.categories[index2]] = 
                [appData.categories[index2], appData.categories[index1]];
            }
        }

        // ‰∫§Êç¢Ê†ºÂ≠êÈ°∫Â∫è
        function swapGrids(gridId1, gridId2) {
            const index1 = appData.grids.findIndex(grid => grid.id === gridId1);
            const index2 = appData.grids.findIndex(grid => grid.id === gridId2);
            
            if (index1 !== -1 && index2 !== -1) {
                // ‰∫§Êç¢Êï∞ÁªÑ‰∏≠ÁöÑ‰ΩçÁΩÆ
                [appData.grids[index1], appData.grids[index2]] = 
                [appData.grids[index2], appData.grids[index1]];
            }
        }

        // ÂàÜÁ±ªÂàáÊç¢+Êñ∞Â¢û + Âè≥ÈîÆÁºñËæë
        function bindCategoryEvents() {
            // ÂàÜÁ±ªÂàáÊç¢
            categoryBar.addEventListener('click', (e) => {
                const categoryBtn = e.target.closest('.category-btn');
                if (!categoryBtn || categoryBtn.classList.contains('editing') || categoryBtn.classList.contains('dragging')) return;
                
                // Êõ¥Êñ∞ÊøÄÊ¥ªÁä∂ÊÄÅ
                document.querySelectorAll('.category-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                categoryBtn.classList.add('active');
                
                activeCategory = categoryBtn.dataset.category;
                renderGridsByCategory();
            });

            // Êñ∞Â¢ûÂàÜÁ±ª
            addCategoryBtn.addEventListener('click', () => {
                const newCategory = `ÂàÜÁ±ª${appData.categories.length + 1}`;
                appData.categories.push(newCategory);
                
                // Áõ¥Êé•ÂàõÂª∫Êñ∞ÁöÑÂàÜÁ±ªÊåâÈíÆ
                const categoryBtn = document.createElement('div');
                categoryBtn.className = 'category-btn';
                categoryBtn.dataset.category = newCategory;
                categoryBtn.textContent = newCategory;
                categoryBtn.draggable = true;
                
                categoryBar.insertBefore(categoryBtn, addCategoryBtn);
            });

            // ÂàÜÁ±ªÂè≥ÈîÆËèúÂçï
            categoryBar.addEventListener('contextmenu', (e) => {
                const categoryBtn = e.target.closest('.category-btn');
                if (!categoryBtn || categoryBtn.dataset.category === 'all') {
                    e.preventDefault();
                    return;
                }
                
                e.preventDefault();
                showCategoryContextMenu(e.clientX, e.clientY, categoryBtn);
            });

            // ÁÇπÂáªÂÖ∂‰ªñÂú∞ÊñπÈöêËóèÂè≥ÈîÆËèúÂçï
            document.addEventListener('click', () => {
                hideContextMenu();
            });
        }

        // ÊòæÁ§∫ÂàÜÁ±ªÂè≥ÈîÆËèúÂçï
        function showCategoryContextMenu(x, y, categoryBtn) {
            // ÁßªÈô§Áé∞ÊúâÁöÑÂè≥ÈîÆËèúÂçï
            hideContextMenu();
            
            const contextMenu = document.createElement('div');
            contextMenu.className = 'context-menu';
            contextMenu.style.left = x + 'px';
            contextMenu.style.top = y + 'px';
            
            // ÁºñËæëÈÄâÈ°π
            const editItem = document.createElement('div');
            editItem.className = 'context-menu-item';
            editItem.textContent = 'ÁºñËæëÂêçÁß∞';
            editItem.onclick = () => startCategoryEdit(categoryBtn);
            
            // Âà†Èô§ÈÄâÈ°π
            const deleteItem = document.createElement('div');
            deleteItem.className = 'context-menu-item delete';
            deleteItem.textContent = 'Âà†Èô§ÂàÜÁ±ª';
            deleteItem.onclick = () => deleteCategory(categoryBtn);
            
            contextMenu.appendChild(editItem);
            contextMenu.appendChild(deleteItem);
            
            document.body.appendChild(contextMenu);
        }

        // ÈöêËóèÂè≥ÈîÆËèúÂçï
        function hideContextMenu() {
            const existingMenu = document.querySelector('.context-menu');
            if (existingMenu) {
                existingMenu.remove();
            }
        }

        // ÂºÄÂßãÁºñËæëÂàÜÁ±ªÂêçÁß∞
        function startCategoryEdit(categoryBtn) {
            const oldCategory = categoryBtn.dataset.category;
            const currentText = categoryBtn.textContent;
            
            // ËÆæÁΩÆÁºñËæëÁä∂ÊÄÅ
            categoryBtn.classList.add('editing');
            
            // ÂàõÂª∫ËæìÂÖ•Ê°Ü
            const input = document.createElement('input');
            input.className = 'category-input';
            input.type = 'text';
            input.value = currentText;
            input.maxLength = 20;
            
            // Ê∏ÖÁ©∫ÊåâÈíÆÂÜÖÂÆπÂπ∂Ê∑ªÂä†ËæìÂÖ•Ê°Ü
            categoryBtn.innerHTML = '';
            categoryBtn.appendChild(input);
            input.focus();
            input.select();
            
            // ‰øùÂ≠òÁºñËæë
            const saveEdit = () => {
                const newName = input.value.trim();
                
                // Ê∏ÖÈô§ÁºñËæëÁä∂ÊÄÅ
                categoryBtn.classList.remove('editing');
                
                if (newName && newName !== oldCategory) {
                    // Êõ¥Êñ∞ÂàÜÁ±ªÂêçÁß∞
                    updateCategoryName(oldCategory, newName);
                    renderCategories();
                } else {
                    renderCategories();
                }
                
                renderGridsByCategory();
            };
            
            // ÂõûËΩ¶‰øùÂ≠ò
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    saveEdit();
                } else if (e.key === 'Escape') {
                    categoryBtn.classList.remove('editing');
                    renderCategories();
                    renderGridsByCategory();
                }
            });
            
            // Â§±ÂéªÁÑ¶ÁÇπ‰øùÂ≠ò
            input.addEventListener('blur', () => {
                setTimeout(saveEdit, 100);
            });
            
            hideContextMenu();
        }

        // Êõ¥Êñ∞ÂàÜÁ±ªÂêçÁß∞
        function updateCategoryName(oldName, newName) {
            // Êõ¥Êñ∞ÂàÜÁ±ªÂàóË°®
            const categoryIndex = appData.categories.indexOf(oldName);
            if (categoryIndex !== -1) {
                appData.categories[categoryIndex] = newName;
            }
            
            // Êõ¥Êñ∞ÊâÄÊúâ‰ΩøÁî®ËØ•ÂàÜÁ±ªÁöÑÊ†ºÂ≠ê
            appData.grids.forEach(grid => {
                if (grid.category === oldName) {
                    grid.category = newName;
                }
            });
            
            // Â¶ÇÊûúÂΩìÂâçÊøÄÊ¥ªÁöÑÂàÜÁ±ªË¢´‰øÆÊîπÔºåÊõ¥Êñ∞ÊøÄÊ¥ªÁä∂ÊÄÅ
            if (activeCategory === oldName) {
                activeCategory = newName;
            }
        }

        // Âà†Èô§ÂàÜÁ±ª
        function deleteCategory(categoryBtn) {
            const categoryToDelete = categoryBtn.dataset.category;
            
            if (confirm(`Á°ÆÂÆöË¶ÅÂà†Èô§ÂàÜÁ±ª"${categoryToDelete}"ÂêóÔºüÊ≠§Êìç‰Ωú‰ºöÂ∞ÜÂ±û‰∫éËØ•ÂàÜÁ±ªÁöÑÊ†ºÂ≠êÁßªÂä®Âà∞"ÈªòËÆ§"ÂàÜÁ±ª„ÄÇ`)) {
                // Â∞ÜÊâÄÊúâÂ±û‰∫éËØ•ÂàÜÁ±ªÁöÑÊ†ºÂ≠êÁßªÂä®Âà∞ÈªòËÆ§ÂàÜÁ±ª
                appData.grids.forEach(grid => {
                    if (grid.category === categoryToDelete) {
                        grid.category = 'ÈªòËÆ§';
                    }
                });
                
                // ‰ªéÂàÜÁ±ªÂàóË°®‰∏≠ÁßªÈô§
                appData.categories = appData.categories.filter(cat => cat !== categoryToDelete);
                
                // Â¶ÇÊûúÂà†Èô§ÁöÑÊòØÂΩìÂâçÊøÄÊ¥ªÁöÑÂàÜÁ±ªÔºåÂàáÊç¢Âà∞ÂÖ®ÈÉ®
                if (activeCategory === categoryToDelete) {
                    activeCategory = 'all';
                }
                
                // ÈáçÊñ∞Ê∏≤Êüì
                renderCategories();
                renderGridsByCategory();
            }
            
            hideContextMenu();
        }

        // Ê†ºÂ≠êÂçïÂáªÂ§çÂà∂
        function bindGridClickCopy() {
            gridContainer.addEventListener('click', async (e) => {
                const gridElem = e.target.closest('.grid-item');
                if (!gridElem || gridElem.classList.contains('dragging')) return;
                const text = gridElem.textContent.trim();
                if (text) {
                    await navigator.clipboard.writeText(text);
                    showToast(copyToast);
                }
            });
        }

        // Ê†ºÂ≠êÂè≥ÈîÆÁºñËæë
        function bindGridRightClickEdit() {
            gridContainer.addEventListener('contextmenu', (e) => {
                const gridElem = e.target.closest('.grid-item');
                if (!gridElem) return;
                e.preventDefault();
                gridElem.contentEditable = 'true';
                gridElem.focus();
                const range = document.createRange();
                range.selectNodeContents(gridElem);
                const selection = window.getSelection();
                selection.removeAllRanges();
                selection.addRange(range);
            });
        }

        // Ê†ºÂ≠êÁºñËæëÁªìÊùü
        function bindGridEditEnd() {
            gridContainer.addEventListener('blur', (e) => {
                const gridElem = e.target.closest('.grid-item');
                if (!gridElem || gridElem.contentEditable !== 'true') return;

                const newContent = gridElem.textContent.trim();
                const gridId = gridElem.dataset.gridId;

                const gridIndex = appData.grids.findIndex(grid => grid.id === gridId);
                if (gridIndex === -1) return;

                if (!newContent) {
                    appData.grids.splice(gridIndex, 1);
                } else {
                    appData.grids[gridIndex].content = newContent;
                }

                gridElem.contentEditable = 'false';
                renderGridsByCategory();
            }, true);

            gridContainer.addEventListener('keydown', (e) => {
                const gridElem = e.target.closest('.grid-item');
                if (e.key === 'Enter' && !e.shiftKey && gridElem?.contentEditable === 'true') {
                    e.preventDefault();
                    gridElem.blur();
                }
            });
        }

        // Êñ∞Â¢ûÊ†ºÂ≠ê
        function bindAddGrid() {
            addGridBtn.addEventListener('click', () => {
                const newCategory = activeCategory === 'all' ? 'ÈªòËÆ§' : activeCategory;
                const newGrid = {
                    id: generateUuid(),
                    content: `Êñ∞ÊñáÊú¨${appData.grids.length + 1}`,
                    category: newCategory
                };
                appData.grids.push(newGrid);
                renderGridsByCategory();
            });
        }

        // ‰øÆÂ§ç‰øùÂ≠òÂäüËÉΩ - ‰ΩøÁî®ÁÆÄÂçïÂèØÈù†ÁöÑÊñπÊ≥ï
        function bindSaveFile() {
            saveFileBtn.addEventListener('click', () => {
                try {
                    // Ëé∑ÂèñÂΩìÂâçHTMLÁªìÊûÑ
                    let htmlCode = document.documentElement.outerHTML;
                    
                    // ‰ΩøÁî®Á≤æÁ°ÆÁöÑÊ≠£ÂàôË°®ËææÂºèÊõøÊç¢appData
                    const appDataStr = JSON.stringify(appData, null, 2);
                    const regex = /let appData\s*=\s*\{[\s\S]*?\};/;
                    
                    if (regex.test(htmlCode)) {
                        htmlCode = htmlCode.replace(regex, `let appData = ${appDataStr};`);
                        
                        // ÂàõÂª∫Âπ∂‰∏ãËΩΩÊñá‰ª∂
                        const blob = new Blob([htmlCode], { type: 'text/html' });
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = 'ÂçÅ‰∏â-Âø´Êç∑ÂõûÂ§ç.html';
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        URL.revokeObjectURL(url);
                        showToast(saveToast);
                    } else {
                        // Â¶ÇÊûúÊ≠£ÂàôÂåπÈÖçÂ§±Ë¥•Ôºå‰ΩøÁî®Â§áÁî®ÊñπÊ≥ï
                        alert('‰øùÂ≠òÂ§±Ë¥•ÔºöÊï∞ÊçÆÊ†ºÂºèÈîôËØØÔºåËØ∑ÈáçËØï');
                    }
                } catch (error) {
                    console.error('‰øùÂ≠òÂ§±Ë¥•:', error);
                    alert('‰øùÂ≠òÂ§±Ë¥•ÔºåËØ∑ÈáçËØï');
                }
            });
        }

        // ÊèêÁ§∫Ê°ÜÊòæÁ§∫
        function showToast(toastElem) {
            toastElem.classList.add('show');
            setTimeout(() => toastElem.classList.remove('show'), 1500);
        }

        // È°µÈù¢Âä†ËΩΩÂàùÂßãÂåñ
        window.addEventListener('load', init);
    </script>
</body>
</html>